{% extends 'base.html' %}
{% block title %}Dashboard - Inventory System{% endblock %}
{% block content %}

<div class="row">
    <div class="col-12">
        <h1 class="page-title"><i class="fas fa-chart-bar"></i> Dashboard</h1>
    </div>
</div>

<!-- KPI Cards -->
<div class="row mb-4 g-3">
    <div class="col-lg-3 col-md-6 col-sm-12">
        <div class="card text-center border-0 position-relative overflow-hidden">
            <div class="position-absolute top-0 end-0 p-3 opacity-10">
                <i class="fas fa-boxes" style="font-size: 3rem;"></i>
            </div>
            <div class="card-body">
                <h6 class="card-title text-muted mb-2">Total Products</h6>
                <h2 class="text-primary fw-bold">{{ total_products }}</h2>
                <small class="text-muted">items in inventory</small>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12">
        <div class="card text-center border-0 position-relative overflow-hidden">
            <div class="position-absolute top-0 end-0 p-3 opacity-10">
                <i class="fas fa-tags" style="font-size: 3rem;"></i>
            </div>
            <div class="card-body">
                <h6 class="card-title text-muted mb-2">Categories</h6>
                <h2 class="text-success fw-bold">{{ total_categories }}</h2>
                <small class="text-muted">product categories</small>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12">
        <div class="card text-center border-0 position-relative overflow-hidden">
            <div class="position-absolute top-0 end-0 p-3 opacity-10">
                <i class="fas fa-truck" style="font-size: 3rem;"></i>
            </div>
            <div class="card-body">
                <h6 class="card-title text-muted mb-2">Suppliers</h6>
                <h2 class="text-info fw-bold">{{ total_suppliers }}</h2>
                <small class="text-muted">active suppliers</small>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 col-sm-12">
        <div class="card text-center border-0 position-relative overflow-hidden"
            style="border-left: 4px solid #f59e0b;">
            <div class="position-absolute top-0 end-0 p-3 opacity-10">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
            </div>
            <div class="card-body">
                <h6 class="card-title text-muted mb-2">Low Stock</h6>
                <h2 class="text-warning fw-bold">{{ low_stock|length }}</h2>
                <small class="text-muted">needs reorder</small>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="row g-4 mb-4">
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header bg-gradient text-white d-flex align-items-center"
                style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <i class="fas fa-exclamation-circle me-2"></i>
                <h5 class="mb-0">‚ö†Ô∏è Low Stock Alert</h5>
            </div>
            <div class="card-body">
                {% if low_stock %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th><i class="fas fa-box"></i> Product</th>
                                <th><i class="fas fa-database"></i> Qty</th>
                                <th><i class="fas fa-flag"></i> Level</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in low_stock %}
                            <tr>
                                <td>
                                    <a href="{% url 'product_detail' product.id %}" class="text-decoration-none fw-500">
                                        {{ product.name }}
                                    </a>
                                </td>
                                <td>
                                    <span class="badge bg-danger">{{ product.quantity }}</span>
                                </td>
                                <td>{{ product.reorder_level }}</td>
                                <td>
                                    <a href="{% url 'stock_transaction' %}" class="btn btn-sm btn-warning">
                                        <i class="fas fa-plus"></i> Restock
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-success border-0 mb-0">
                    <i class="fas fa-check-circle"></i> All products have sufficient stock!
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-5">
        <div class="card">
            <div class="card-header bg-gradient text-white d-flex align-items-center"
                style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                <i class="fas fa-random me-2"></i>
                <h5 class="mb-0">üìä Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'add_product' %}"
                        class="btn btn-primary d-flex align-items-center justify-content-center">
                        <i class="fas fa-plus me-2"></i> Add New Product
                    </a>
                    <a href="{% url 'stock_transaction' %}"
                        class="btn btn-warning d-flex align-items-center justify-content-center">
                        <i class="fas fa-exchange-alt me-2"></i> Record Transaction
                    </a>
                    <a href="{% url 'add_category' %}"
                        class="btn btn-success d-flex align-items-center justify-content-center">
                        <i class="fas fa-tag me-2"></i> Add Category
                    </a>
                    <a href="{% url 'add_supplier' %}"
                        class="btn btn-info d-flex align-items-center justify-content-center">
                        <i class="fas fa-truck me-2"></i> Add Supplier
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Transactions -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-gradient text-white d-flex align-items-center"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <i class="fas fa-history me-2"></i>
                <h5 class="mb-0">üìã Recent Transactions</h5>
            </div>
            <div class="card-body">
                {% if recent_transactions %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th><i class="fas fa-box"></i> Product</th>
                                <th><i class="fas fa-arrow-right-arrow-left"></i> Type</th>
                                <th><i class="fas fa-warehouse"></i> Quantity</th>
                                <th><i class="fas fa-calendar"></i> Date & Time</th>
                                <th><i class="fas fa-user"></i> User</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trans in recent_transactions %}
                            <tr>
                                <td>
                                    <a href="{% url 'product_detail' trans.product.id %}"
                                        class="text-decoration-none fw-500">
                                        {{ trans.product.name }}
                                    </a>
                                </td>
                                <td>
                                    {% if trans.transaction_type == 'IN' %}
                                    <span class="badge bg-success"><i class="fas fa-arrow-down"></i> Stock In</span>
                                    {% else %}
                                    <span class="badge bg-danger"><i class="fas fa-arrow-up"></i> Stock Out</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{{ trans.quantity }}</span>
                                </td>
                                <td><small>{{ trans.date|date:"M d, Y H:i" }}</small></td>
                                <td>{{ trans.performed_by.username }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info border-0 mb-0">
                    <i class="fas fa-info-circle"></i> No transactions recorded yet.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-4px);
    }

    .bg-gradient {
        background-size: 200% 200%;
        animation: gradient 3s ease infinite;
    }

    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    .fw-500 {
        font-weight: 500;
    }

    table tbody tr {
        transition: background-color 0.2s ease;
    }

    table tbody tr:hover {
        background-color: #f9fafb;
    }
</style>

{% endblock %}